function addCommas(a){a+="",x=a.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var b=/(\d+)(\d{3})/;b.test(x1);)x1=x1.replace(b,"$1,$2");return x1+x2}function getToplineDate(a){var b=a.substring(0,2),c=a.substring(4,5),d=a.substring(6,8);return c=monthNames[c-1],b+" "+c+" 20"+d}var Vizlib=function(sources,callback){function loadFrame(a,b){activeFrame=a,d3.selectAll(".frame").transition().duration(b).style("opacity",0).style("display","none"),d3.selectAll(".frame"+a).transition().duration(b).style("opacity",1).style("display","block"),1==activeFrame?$("#framePrev").prop("disabled",!0):$("#framePrev").prop("disabled",!1),activeFrame==maxFrames?($("#frameNext").prop("disabled",!0),$("#rightButton").hide()):$("#frameNext").prop("disabled",!1)}function initFrame(){loadFrame(activeFrame,0)}function frameHandler(a,b){var c={};return c.frame=!0,$.isArray(a)?a.forEach(function(a){c["frame"+a]=!0}):c["frame"+a]=!0,b.classed(c),b}function addCommas(a){a+="",x=a.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var b=/(\d+)(\d{3})/;b.test(x1);)x1=x1.replace(b,"$1,$2");return x1+x2}function wrap(a,b,c){a.each(function(){for(var a,d=d3.select(this),e=c.split(/\s+/).reverse(),f=[],g=0,h=d.attr("x"),i=d.attr("y"),j=d.text(null).append("tspan").attr("x",h).attr("y",i).attr("dy","0em");a=e.pop();)f.push(a),j.text(f.join(" ")),j.node().getComputedTextLength()>b&&(f.pop(),j.text(f.join(" ")),f=[a],j=d.append("tspan").attr("x",h).attr("y",i).attr("dy",1.3*++g+0+"em").text(a))})}var svg,logging=!0,arrow=0,patternId=0,color=["#7A7A7A","#BFBFBF","purple"];if(2==arguments.length){var data=[],runstr="queue()";sources.forEach(function(a,b){var c=(new Date).getTime(),d="d3.json";a.source.indexOf(".json")>-1&&(d="d3.json"),a.source.indexOf(".csv")>-1&&(d="d3.csv"),a.source.indexOf(".svg")>-1&&(d="d3.xml"),sources.length-1!=b?runstr+=".defer("+d+', "'+a.source+"?_="+c+'")':runstr+=".defer("+d+', "'+a.source+"?_="+c+'").await(function(){for (i = 1; i < arguments.length; i++) { data[sources[i-1].name] = arguments[i];}; callback(data); });'}),eval(runstr)}var activeFrame=1,maxFrames=4;this.maxFrames=function(a){maxFrames=a},this.gotoFrame=function(a,b){loadFrame(a,b)},this.nextFrame=function(a){return activeFrame++,this.gotoFrame(activeFrame,a),activeFrame},this.prevFrame=function(a){return activeFrame-=1,this.gotoFrame(activeFrame,a),activeFrame},this.hide=function(a){var b=1e3,c=0;if(a.fade&&(b=a.fade),a.delay&&(c=a.delay),a.destroy&&a.destroy,void 0==a.object||""==a.object)return alert("hide: no object has been set - e.g. 'object': pie1"),!1;var d=a.object;d.transition().delay(c).duration(b).style("opacity",0),1==a.destroy&&d.remove()},this.show=function(a){var b=1e3,c=0,d=1;if(a.fade&&(b=a.fade),a.delay&&(c=a.delay),a.opacity&&(d=a.opacity),void 0==a.object||""==a.object)return alert("hide: no object has been set - e.g. 'object': pie1"),!1;a.object.transition().delay(c).duration(b).style("opacity",d)},this.log=function(a){this.logging&&console.log(a)};var rounder=function(a){var b=Math.abs(a);return b<100?10*Math.ceil(a/10):b<500?50*Math.ceil(a/50):b<1e3?100*Math.ceil(a/100):b<1e4?1e3*Math.ceil(a/1e3):void 0};this.createSvg=function(a){var b="100%",c="100%",d="svg",e=2;if(void 0==a.div||""==a.div)return alert("createSvg: no div has been set - e.g. 'div': '#box1'"),!1;if(void 0==a.id||""==a.id)return alert("createSvg: no id has been set for the svg - e.g. 'id': 'svg1'"),!1;a.width&&(b=a.width),a.height&&(c=a.height),a.id&&(id=a.id),a.class&&(d=a.class),a.div&&(div=a.div),a.aspectRatio&&(e=a.aspectRatio),void 0!=a.downloadButton&&a.downloadButton;var f=1200*e,g=$(div).width(),h=$(div).height();g/e>h&&$(div).width($(div).height()*e);var i=$(div).width();return $(div).height(i/e),window.onresize=function(a){$(div).width("100%"),$(div).height("100%");var b=$(div).width(),c=$(div).height();b/e>c&&$(div).width($(div).height()*e)},this.svg=d3.select(div).append("svg").attr("id",id).attr("class",d).attr("height",c).attr("width",b).attr("viewBox","0 0 1200 "+f).attr("preserveAspectRatio","xMinYMin slice"),void 0!=a.frame&&(vector=frameHandler(a.frame,this.svg)),this.svg},this.rect=function(a){var b="green",c=50,d=50,e=2,f="darkgreen",g=1,h=0,i=0;return a.fill&&(b=a.fill),a.width&&(c=a.width),a.height&&(d=a.height),a.strokeWidth&&(e=a.strokeWidth),a.strokeColor&&(f=a.strokeColor),a.opacity&&(g=a.opacity),a.thisClass&&a.thisClass,a.x&&(h=a.x),a.y&&(i=a.y),a.fade&&a.fade,a.delay&&a.delay,void 0==a.appendTo||""==a.appendTo?(alert("rect: no appendTo object has been set - e.g. 'appendTo': svg1"),!1):a.appendTo.append("rect").attr("x",h).attr("y",i).attr("width",c).attr("height",d).style("fill",b).style("stroke",f).style("stroke-width",e).style("opacity",g)},this.tableBar=function(a){var b="tablebar",c="tableBar1",d=0,e=0,f=5,g=1,h=300,i=300;if(a.thisClass&&(b=a.thisClass),a.opacity&&a.opacity,a.xOffset&&(d=a.xOffset),a.yOffset&&(e=a.yOffset),a.fade&&a.fade,a.delay&&a.delay,a.source&&(k=a.source),a.innerRadius&&(innerRadius=a.innerRadius),void 0!==a.innerBorder&&(innerBorder=a.innerBorder),void 0!==a.enableText&&(enableText=a.enableText),a.fontSize&&(fontSize=a.fontSize),a.padding&&a.padding,a.height&&(h=a.height),a.width&&(i=a.width),a.title&&a.title,a.limit&&(f=a.limit),a.valueField&&(valueField=a.valueField),a.nameField&&(nameField=a.nameField),a.class&&(b=a.thisClass),a.id&&(c=a.id),a.fill&&a.fill,a.fillOpacity&&(g=a.fillOpacity),void 0==a.appendTo||""==a.appendTo)return alert("pie: no appendTo object has been set - e.g. 'appendTo': svg1"),!1;var j=a.appendTo;k.sort(function(a,b){return+b.total-+a.total});var k=k.filter(function(a){return"undefined"!==a.key&&"TBD"!==a.key}),l=d3.max(k,function(a){return a.total}),m=d3.scale.linear().range([0,i-50]).domain([0,l]),n=j.append("g").attr("id",c).attr("transform","translate("+d+","+e+")"),o=n.selectAll("."+b).data(k.filter(function(a,b){return b<f})).enter().append("g").attr("class",b).attr("transform",function(a,b){return"translate(0,"+(b*(h/f)+5)+")"}),p=["#CB171D","#F16912"];o.selectAll(".rowBar").data(function(a,b){return a.bars}).enter().append("rect").attr("class","rowBar").attr("width",function(a){return m(a)}).style("fill",function(a,b){return p[b]}).style("fill-opacity",g).attr("height",h/f-5).attr("y",0).attr("x",function(a,b){var c;return c=b>0?d3.select(this.parentNode).datum().bars[b-1]:0,m(c)}).style("stroke","#FFF").style("stroke-opacity",.5),o.append("text").style("text-anchor","end").attr("y",14).attr("x",-5).style("font-size","11px").text(function(a){return a[nameField]});o.append("text").attr("y",14).attr("x",function(a){return m(a.total)+3}).style("font-size","11px").attr("fill",function(a,b){return p[0]}).style("font-weight","bold").text(function(a){return addCommas(a.bars[0])}).attr("class",function(a){return a.bWidth=d3.select(this).node().getBBox().width,"t1"});t2Divider=o.append("text").attr("y",14).attr("x",function(a){return m(a.total)+a.bWidth+6}).attr("fill","#B5B5B5").style("font-size","11px").style("font-weight","bold").text(function(a){return"|"}),t2=o.append("text").attr("fill",function(a,b){return p[1]}).attr("y",14).attr("x",function(a){return m(a.total)+a.bWidth+12}).style("font-size","11px").style("font-weight","bold").text(function(a){return addCommas(a.bars[1])});n.node().getBBox();void 0!=a.frame&&(n=frameHandler(a.frame,n))},this.pie=function(a){var b="pie1",c=1,d=0,e=0,f=[5,3],g=.4,h=!0,i="30px",j=0,k=300,l=300,m="Title";if(a.thisClass&&a.thisClass,a.opacity&&(c=a.opacity),a.x&&(d=a.x),a.y&&(e=a.y),a.fade&&a.fade,a.delay&&a.delay,a.data&&(f=a.data),a.innerRadius&&(g=a.innerRadius),void 0!==a.innerBorder&&a.innerBorder,void 0!==a.enableText&&(h=a.enableText),a.fontSize&&(i=a.fontSize),a.padding&&(j=a.padding),a.height&&(k=a.height),a.width&&(l=a.width),a.title&&(m=a.title),void 0==a.appendTo||""==a.appendTo)return alert("pie: no appendTo object has been set - e.g. 'appendTo': svg1"),!1;var n=a.appendTo;if(void 0==a.id||""==a.id)return alert("pie: no id has been set - e.g. 'id': svg1"),!1;var b=a.id,o=f,p=Math.min(l/2,$("#"+n.attr("id")).height()/2),p=p-j,q=d3.svg.arc().outerRadius(p-10).innerRadius(p-p*g),r=d3.layout.pie().sort(null).value(function(a){return a}),s=n.append("g").attr("id",b).attr("transform","translate("+parseInt(d)+","+parseInt(e)+")").style("opacity",c);s.append("text").attr("x",-l/2+15).attr("y",-k/2).style("font-family","'Open Sans', sans-serif").style("font-weight","bold").style("font-size","16px").text(m),s.append("text").attr("id","pieTitleSub").attr("x",-l/2+95).attr("y",-k/2-1).style("font-family","'Open Sans', sans-serif").style("font-weight","normal").style("font-size","13px").text("(Nationwide)");var t=s.selectAll(".arc").data(r(o)).enter().append("g").attr("class","arc"),t=s.selectAll("path").data(r(o)).enter().append("path").attr("d",q).style("stroke","#FFF").style("stroke-width",1).style("stroke-opacity",.3).style("fill",function(a,b){return color[b]}).each(function(a){this._current=a});if(1==h){var u=s.append("g");u.append("text").attr("class","piePercent").style("font-size",i).style("font-weight","bold").style("text-anchor","middle").text(function(a){var b=o[0]/(o[0]+o[1])*100;return Math.round(b)+"%"}).attr("y",function(){return this.getBBox().height/4})}return this.innerRing&&s.append("circle").attr("r",function(){return p-p*g-2}).attr("cx",0).attr("cy",0).style("fill","transparent").style("stroke","#bfbfbf").style("stroke-width",1),t.update=function(a){function b(a){var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){return q(b(a))}}function c(a){var b=d3.interpolate(this._current,{startAngle:2*Math.PI,endAngle:2*Math.PI,value:0});return this._current=b(0),function(a){return q(b(a))}}var d=1e3;if(a.transition&&(d=a.transition),void 0==a.data||""==a.data)return alert("pie.update: no data has been set - e.g. 'data': [1,2,3]"),!1;var e=a.data;if(void 0==a.id||""==a.id)return alert("pie.update: no id has been set - e.g. 'id': '#pie1'"),!1;var f=a.id,g={startAngle:2*Math.PI,endAngle:2*Math.PI},h=d3.select(f),i=h.selectAll("path").data(r(e));return i.enter().append("path").style("fill",function(a,b){return color[b]}).attr("d",q(g)).each(function(a){this._current={data:a.data,value:a.value,startAngle:g.startAngle,endAngle:g.endAngle}}),i.exit().transition().duration(d).attrTween("d",c).remove(),i.transition().duration(d).attrTween("d",b),h.select(".piePercent").text(function(a){var b=e[0]/(e[0]+e[1])*100;return Math.round(b)+"%"}),h.selectAll("path")},void 0!=a.frame&&(s=frameHandler(a.frame,s)),t},this.lineChart=function(){return new function(){this.data=[{date:"2011-08-01",value:120},{date:"2011-08-03",value:10},{date:"2011-08-04",value:16},{date:"2011-08-11",value:113},{date:"2011-09-01",value:90},{date:"2011-09-02",value:11},{date:"2011-09-05",value:14},{date:"2011-10-05",value:134},{date:"2011-11-05",value:324}],this.color=color[0],this.barSpace=.43,this.yAxisEnabled=!0,this.dataLabelsEnabled=!0,this.yAxisGrid=!0,this.cumulative=!1,this.xAxisFormat="%b %Y",this.spline=!1,this.area=!0,this.create=function(a){var b=this.cumulative,c={top:38,right:15,bottom:25,left:40};0==this.yAxisEnabled&&(c.left=c.right);var d=$("#"+a.attr("id")).width()-c.left-c.right,e=$("#"+a.attr("id")).height()-c.top-c.bottom,f=(this.color,this.data),g=d3.time.format("%Y-%m-%d").parse,h=0;f.forEach(function(a){a.date=g(a.date),1==b?(h+=a.value,a.value=h):a.value=+a.value});var i=d3.time.scale().range([0,d]).domain(d3.extent(f,function(a){return a.date})),j=d3.max(f,function(a){return a.value}),k=d3.scale.linear().range([e,0]).domain([0,rounder(j)]),l=d3.svg.axis().scale(i).orient("bottom").tickSize(3,0,0).ticks(d3.time.months,1).tickFormat(d3.time.format(this.xAxisFormat)),m=d3.svg.axis().scale(k).orient("left").ticks(4).tickPadding(0);if(0==this.area)var n=d3.svg.line().x(function(a){return i(a.date)}).y(function(a){return k(a.value)});else var n=d3.svg.area().x(function(a){return i(a.date)}).y0(e).y1(function(a){return k(a.value)});1==this.spline&&n.interpolate("monotone");var o=a.append("g").attr("class","lineChart").attr("transform","translate("+c.left+","+c.top+")");if(1==this.yAxisEnabled&&o.append("g").attr("class","yAxis axis").call(m).append("text").attr("class","axisLabel").attr("transform","rotate(-90)").attr("y",-36).attr("dy",".71em").attr("x",-e/2+25).style("text-anchor","end"),1==this.yAxisGrid){var p=m.tickSize(d,0).tickFormat("").orient("right");o.append("g").classed("y",!0).classed("grid",!0).call(p)}var q=Math.abs(i(new Date("2011-01-01"))-i(new Date("2011-02-01")))/2;o.append("g").attr("class","xAxis axis").attr("transform","translate(0,"+e+")").call(l).selectAll(".lineChart .tick text").style("text-anchor","middle").attr("x",q).attr("y",5);var n=o.append("path").datum(f).attr("class","line").attr("d",n).style("stroke",color[0]).style("stroke-width","1.5px");return 1==this.area&&n.style("fill",color[0]),o}}},this.columnChart=function(){return new function(){this.data=[{series:"Cats",value:120},{series:"Dogs",value:10},{series:"Giraffes",value:16},{series:"Ostriches",value:113},{series:"Lions",value:90},{series:"Cheetahs",value:11},{series:"Elephants",value:14}],this.color=["#00937F"],this.barSpace=.43,this.yAxisEnabled=!0,this.dataLabelsEnabled=!0,this.yAxisGrid=!0,this.create=function(a){var b={top:38,right:15,bottom:25,left:40};0==this.yAxisEnabled&&(b.left=b.right);var c=$("#"+a.attr("id")).width()-b.left-b.right,d=$("#"+a.attr("id")).height()-b.top-b.bottom,e=this.color,f=this.data,g=d3.scale.ordinal().rangeRoundBands([0,c],this.barSpace).domain(f.map(function(a){return a.series})),h=d3.max(f,function(a){return a.value}),i=d3.scale.linear().range([d,0]).domain([0,rounder(h)]),j=d3.svg.axis().scale(g).orient("bottom").tickSize(0).tickPadding(7),k=d3.svg.axis().scale(i).orient("left").ticks(3).tickPadding(0),l=a.append("g").attr("class","columnChart").attr("transform","translate("+b.left+","+b.top+")");if(1==this.yAxisEnabled&&l.append("g").attr("class","yAxis axis").call(k).append("text").attr("class","axisLabel").attr("transform","rotate(-90)").attr("y",-36).attr("dy",".71em").attr("x",-d/2+25).style("text-anchor","end"),1==this.yAxisGrid){var m=k.tickSize(c,0).tickFormat("").orient("right");l.append("g").classed("y",!0).classed("grid",!0).call(m)}l.append("g").attr("class","xAxis axis").attr("transform","translate(0,"+d+")").call(j);var n=l.selectAll(".bar").data(f).enter().append("g").attr("class","bar");return n.append("rect").attr("x",function(a){return g(a.series)}).attr("width",g.rangeBand()).attr("y",function(a){return i(a.value)}).attr("height",function(a){return d-i(a.value)}).style("fill",function(a,b){return e.length>1?e[b]:e[0]}).on("mouseover",function(a,b){d3.select(this).style("fill",function(a,b){return e.length>1?e[b]:d3.rgb(e[0]).brighter(.4)})}).on("mouseout",function(a,b){d3.select(this).style("fill",function(a,b){return e.length>1?e[b]:e[0]})}),1==this.dataLabelsEnabled&&n.append("svg:text").attr("class","dataLabel").attr("x",function(a){return g(a.series)+g.rangeBand()/2}).attr("y",function(a){return i(a.value)-3}).style("text-anchor","middle").text(function(a){return a.value}),l}}},this.bubbleChart=function(a){var b=0,c=0;if(a.fill&&a.fill,a.width&&(width=a.width),a.height&&(height=a.height),a.strokeWidth&&a.strokeWidth,a.strokeColor&&a.strokeColor,a.opacity&&a.opacity,a.thisClass&&a.thisClass,a.xOffset&&(b=a.xOffset),a.yOffset&&(c=a.yOffset),a.fade&&a.fade,a.delay&&a.delay,a.source&&(source=a.source),void 0==a.appendTo||""==a.appendTo)return alert("rect: no appendTo object has been set - e.g. 'appendTo': svg1"),!1;var d=a.appendTo;this.barSpace=.43,this.yAxisEnabled=!0,this.dataLabelsEnabled=!0,this.yAxisGrid=!0;var e={top:28,right:25,bottom:25,left:35};0==this.yAxisEnabled&&(e.left=e.right);var f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],g=a.source.features,h=d3.time.scale().range([0,width]).domain(d3.extent(g,function(a){return a.properties.time})),i=h.domain()[0];i.setDate(i.getDate()-1),i.setHours(23),i.setMinutes(59),i.setSeconds(0),h.domain([i,h.domain()[1]])[0];var j=d3.max(g,function(a){return a.properties.mag}),k=d3.min(g,function(a){return a.properties.mag}),l=d3.scale.linear().range([height,0]).domain([k,Math.ceil(j)]),m=d3.scale.linear().domain([k,j]).range([0,30]),n=d3.scale.sqrt().domain([k,j]).range([.1,.5]),o=d3.scale.linear().domain([k,j]).range([.1,3]),p=d3.svg.axis().scale(h).orient("bottom").tickSize(0).ticks(20).tickPadding(7).tickFormat(d3.time.format("%d %b")),q=d3.svg.axis().scale(l).orient("left").ticks(4).tickPadding(0),r=d.append("g").attr("class","bubbleChart frame frame1 frame2 frame3 frame4 frame5").attr("transform","translate("+b+","+c+")");if(1==this.yAxisEnabled&&r.append("g").attr("class","yAxis axis").call(q).append("text").attr("class","axisLabel").attr("transform","rotate(-90)").attr("y",-28).attr("dy",".71em").attr("x",-height/2+25).style("text-anchor","end").style("font-weight","bold").text("Magnitude"),1==this.yAxisGrid){var s=q.tickSize(width,0).tickFormat("").tickPadding(30).orient("right");r.append("g").classed("y",!0).classed("grid",!0).call(s)}r.append("g").attr("class","xAxis axis").attr("transform","translate(0,"+height+")").call(p);var t=p.tickSize(height,0).tickFormat("").tickPadding(0).orient("bottom");return r.append("g").classed("x",!0).classed("xgrid",!0).call(t),r.selectAll(".bubble").data(g).enter().append("g").attr("class","bubble").append("circle").attr("cx",function(a,b){var c=new Date(a.properties.time);return c.getDate(),c.getMonth(),c.getFullYear(),h(a.properties.time)}).attr("cy",function(a){return l(a.properties.mag)}).attr("r",function(a){return m(a.properties.mag)}).style("fill-opacity",function(a){return n(a.properties.mag)}).style("stroke-opacity",function(a){return n(a.properties.mag)}).attr("id",function(a){return"chart"+a.id}).attr("class","chartbubble").style("stroke","#570809").style("stroke-width",function(a){return o(a.properties.mag)}).style("fill","darkred").on("mouseover",function(a,b){d3.select(this).style("stroke-opacity",1);var c=new Date(a.properties.time),d=c.toTimeString().substring(0,5),c=c.getDate()+" "+f[c.getMonth()]+" "+c.getFullYear()+" - "+d;d3.select(".mTitle").text("M"+a.properties.mag),d3.select(".mSubTitle1").text(c),d3.select("#dM2").style("opacity",1);var e=a.id;d3.selectAll(".mapbubble").transition().duration(300).style("fill-opacity",function(a){return a.id==e?.4:.1}).style("stroke-opacity",function(a){return a.id==e?1:.1})}).on("mouseout",function(a,b){d3.selectAll(".mapbubble").transition().duration(300).style("fill-opacity",.4).style("stroke-opacity",function(a){return n(a.properties.mag)}),d3.select(this).style("stroke-opacity",function(a){return n(a.properties.mag)}),d3.select("#dM2").style("opacity",0).attr("transform","translate(-100,-100)")}).on("mousemove",function(a,d){var e=d3.transform(d3.select(this).attr("transform")),f=e.translate[0],g=e.translate[1];coordinates=d3.mouse(this);var h=coordinates[0]+f+b,i=coordinates[1]+g+c;d3.select("#dM2").attr("transform","translate("+(h+13)+","+(i+5)+")")}),void 0!=a.frame&&(r=frameHandler(a.frame,r)),r},this.map=function(a){function b(){if(C.scale(L.scale()/2/Math.PI).translate(L.translate()),G.selectAll(".geopoly path").attr("d",E),G.selectAll(".vector").attr("transform",function(a){return"translate("+C([a.lon,a.lat])+")"}),K.attr("transform",function(a){return"translate("+C([a.lon,a.lat])+")"}),d3.selectAll("#centerAnchor").node()){var a=d3.transform(K.attr("transform")).translate;d3.selectAll(".import").each(function(b){var c=d3.select(this).select("#anchor");if(c.node()){var d=c.node().getBBox(),e=a[0]-(d.x+d.width/2),f=a[1]-(d.y+d.height/2);d3.select(this).attr("transform","translate("+e+","+f+")")}})}G.selectAll(".symbolPoint").attr("transform",function(a){return"translate("+C([a.lon,a.lat])+")"}),G.selectAll(".textLabel").attr("transform",function(a){return"translate("+C([a.lon,a.lat])+")"}),G.selectAll(".styledLabel").attr("transform",function(a){return"translate("+C([a.lon,a.lat])+")"});var b=d3.svg.line().x(function(a){return e=C([a.lon,a.lat]),e[0]}).y(function(a){return e=C([a.lon,a.lat]),e[1]}).interpolate("basis");G.selectAll(".arrow").attr("d",b);if(1==f){var c=B.scale(L.scale()).translate(L.translate())(),g=F.attr("transform","scale("+c.scale+")translate("+c.translate+")").selectAll("image").data(c,function(a){return a});g.exit().remove(),g.enter().append("image").attr("xlink:href",function(a){return"http://"+["a","b","c","d"][4*Math.random()|0]+".tiles.mapbox.com/v3/"+d+"/"+a[2]+"/"+a[0]+"/"+a[1]+".png"}).attr("width",1).attr("height",1).style("opacity",1).attr("class","imgtile").attr("x",function(a){return a[0]}).attr("y",function(a){return a[1]})}}var c=[44,33],d="matthewsmawfield.31370f48",f=!0,g=!0,h=!0,i=!0,j=14,k=3,l=3,m=1.5,n=!0,o=!0,p=0,q=0;a.center&&(c=a.center),a.xOffset&&(p=a.xOffset),a.yOffset&&(q=a.yOffset),a.zoomInit&&(j=a.zoomInit),a.mapbox&&(d=a.mapbox),void 0!=a.enableRaster&&(f=a.enableRaster),void 0!=a.enablePan&&(i=a.enablePan),void 0!=a.enableZoomButtons&&(g=a.enableZoomButtons),void 0!=a.enableZoomMouseScroll&&(h=a.enableZoomMouseScroll),a.zoomInSteps&&(k=a.zoomInSteps),a.zoomOutSteps&&(l=a.zoomOutSteps),a.zoomFactor&&(m=a.zoomFactor),void 0!=a.coordinatesTooltip&&(n=a.coordinatesTooltip),void 0!=a.coordinatesToClipboard&&(o=a.coordinatesToClipboard),void 0!=a.enableDownload&&a.enableDownload;var r=a.appendTo,s=r.attr("viewBox").split(" "),t=s[2],u=s[3],v=t,w=t/u,z=t*w,A=r.append("g").attr("id","mapsvgcontainer").attr("mask","url(#mask)");if(1==f)var B=d3.geo.tile().size([v,z]);var C=d3.geo.mercator().scale((1<<j)/2/Math.PI).translate([0,0]),D=C([c[0],c[1]]),E=d3.geo.path().projection(C),F=A.append("g").attr("id","raster"),G=A.append("g").attr("id","vector"),H=A.append("g").attr("id","maskLayer"),I=r.append("g").attr("id","customLayer"),J=[{lat:c[1],lon:c[0]}],K=I.selectAll("#centerAnchor").data(J).enter().append("g").attr("id","centerAnchor").attr("transform",function(a){return"translate("+C([a.lon,a.lat])+")"}).style("opacity",0);K.append("circle").attr("cx",0).attr("cy",0).attr("r",5).attr("id","anchor").style("fill-opacity",0).style("stroke-opacity",0).style("stroke","blue");var L=d3.behavior.zoom().scale(2*C.scale()*Math.PI).translate([v/2-D[0]+p,z/2-D[1]+q]).on("zoom",b),M=L.scale(),N=L.translate(),O=[v/2,z/2];L.scale(.98*M).translate([O[0]+(N[0]-O[0])/M*M*.98,O[1]+(N[1]-O[1])/M*M*.98]),A.call(L);L.translate(),L.scale();b();var P=r.attr("id")+"coordinatesTooltip";if(A.on("mousemove",function(){if(1==n){var a=C.invert(d3.mouse(this));$("#"+P+" #lon").text(a[0].toFixed(6)),$("#"+P+" #lat").text(a[1].toFixed(6))}}).on("dblclick",function(){if(1==o){var a=C.invert(d3.mouse(this)),b="{name: 'name', lat: "+a[1].toFixed(6)+", lon: "+a[0].toFixed(6)+"},";window.prompt("Copy to clipboard: Ctrl+C, Enter",b)}}),1==n)var Q=$(A[0]).parent("svg").parent("div"),r=$(A[0]).parent("svg"),R=r.attr("class"),O=$(Q).append('<div id="'+P+'" class="coordinatesTooltip '+R+'"><i class="fa fa-crosshairs"></i>&nbsp;Latitude: <span id="lat">34.123</span> | Longitude: <span id="lon">43.12</span></div>');if(0==h&&A.on("mousewheel.zoom",null).on("dblclick.zoom",null).on("DOMMouseScroll.zoom",null).on("wheel.zoom",null),0==i&&A.on("mousedown.zoom",null).on("touchstart.zoom",null).on("touchmove.zoom",null).on("touchend.zoom",null),1==g){var Q=$(A[0]).parent("svg").parent("div"),r=$(A[0]).parent("svg"),R=r.attr("class"),S=Q.attr("id"),T=r.attr("id")+"zoomBox",U='<div id="'+T+'" class="zoomBox '+R+'"><div class="zoom zoomIn"></div><div class="zoom zoomOut"></div></div>';$("#"+S).append(U);$("#"+T+" .zoomIn").on("click",function(){if(L.scale()<(1<<j)*Math.pow(m,k)){var a=L.scale(),c=(L.scaleExtent(),a*m),d=L.translate(),e=[v/2,z/2];L.scale(c).translate([e[0]+(d[0]-e[0])/a*c,e[1]+(d[1]-e[1])/a*c]),b(),L.scale()<(1<<j)*Math.pow(m,k)?($("#"+Q.attr("id")+" .zoomIn").removeClass("disabled"),$("#"+Q.attr("id")+" .zoomOut").removeClass("disabled")):($("#"+Q.attr("id")+" .zoomIn").addClass("disabled"),$("#"+Q.attr("id")+" .zoomOut").removeClass("disabled"))}}),$("#"+T+" .zoomOut").on("click",function(){if(L.scale()>(1<<j)/Math.pow(m,l)){var a=L.scale(),c=(L.scaleExtent(),a/m),d=L.translate(),e=[v/2,z/2];L.scale(c).translate([e[0]+(d[0]-e[0])/a*c,e[1]+(d[1]-e[1])/a*c]),b(),L.scale()>(1<<j)/Math.pow(m,l)?($("#"+Q.attr("id")+" .zoomIn").removeClass("disabled"),$("#"+Q.attr("id")+" .zoomOut").removeClass("disabled")):($("#"+Q.attr("id")+" .zoomIn").removeClass("disabled"),$("#"+Q.attr("id")+" .zoomOut").addClass("disabled"))}})}return A.downloader=function(){var a=($(A[0]).parent("svg").attr("id"),$(A[0]).parent("svg").parent("div")),b=document.getElementById(id);d3.select("#"+a.attr("id")).append("a").attr("href","#").text("download").style({position:"absolute",top:"20px",left:"10px"}).attr("download","download.svg").on("click",function(){var a=r.attr("width"),c=r.attr("height");r.attr("height",1e3).attr("width",1e3);var d=new XMLSerializer,e=d.serializeToString(b);d3.select(this).attr("href","data:Application/octet-stream;filename=download.svg,"+encodeURIComponent(e)),r.attr("height",c).attr("width",a)})},A.addVectorPolygon=function(a){var b,c="polygon",d=2,e="blue",f=.1,g="cyan",h=1,c="polygonPatternFill";a.strokeWidth&&(d=a.strokeWidth),a.strokeColor&&(e=a.strokeColor),void 0!=a.strokeOpacity&&(f=a.strokeOpacity),a.fill&&(g=a.fill),void 0!=a.fillOpacity&&(h=a.fillOpacity),a.opacity&&a.opacity,a.class&&(c=a.class),a.fade&&a.fade,a.delay&&a.delay;var i=topojson.feature(a.source,a.source.objects[Object.keys(a.source.objects)[0]]).features;return b=G.selectAll("."+c).data(i).enter().append("g").attr("class","geopoly"),void 0!=a.frame&&(b=frameHandler(a.frame,b)),b=b.append("path").attr("class",c).attr("d",E).attr("id",function(a){return a.id}).style("fill",function(a){return g}).style("fill-opacity",h).style("stroke",e).style("stroke-width",d).style("stroke-opacity",f).on("mouseover",function(a){}).on("mouseout",function(a){})},A.addVectorPolygonPatternFill=function(a){var b=1,c=2,d="blue",e="polygonPatternFill",f=1,g=0,h=0;a.lineSpace&&(b=a.lineSpace),a.strokeWidth&&(c=a.strokeWidth),a.strokeColor&&(d=a.strokeColor),a.opacity&&(f=a.opacity),a.class&&(e=a.class),a.source&&(source=a.source),a.fade&&(g=a.fade),a.delay&&(h=a.delay);var i=topojson.feature(a.source,a.source.objects[Object.keys(a.source.objects)[0]]).features;patternId+=1;var j=(A.append("defs").append("pattern").attr("id","pattern"+patternId).attr("patternUnits","userSpaceOnUse").attr("width",4+b).attr("height",4+b).append("path").attr("d","M-1,1 l"+(2+b)+",-"+(2+b)+" M0,"+(4+b)+" l"+(4+b)+",-"+(4+b)+" M"+(3+b)+","+(5+b)+" l"+(2+b)+",-"+(2+b)).style("stroke",d).style("stroke-width",c),G.selectAll("."+e).data(i).enter().append("g").attr("class","geopoly").style("opacity",1));return j.append("path").attr("class",e).attr("d",E).attr("id",function(a){return a.id}).style("fill","url(#pattern"+patternId+")").style("opacity",0).on("mouseover",function(a){}).on("mouseout",function(a){}).transition().delay(h).duration(g).style("opacity",f),void 0!=a.frame&&(j=frameHandler(a.frame,j)),j},A.addVectorPoints=function(a){var b=a.source,c=d3.max(b,function(a){return+a.idps}),d=(d3.scale.sqrt().domain([0,c]).range([0,40]),d3.scale.sqrt().domain([0,c]).range([.6,.75])),e=d3.scale.sqrt().domain([0,c]).range([.7,1.6]);vectorGroup=G.selectAll("."+a.class).data(b).enter().append("g").attr("class","vector").style("opacity",1).attr("transform",function(a){return"translate("+C([a.lon,a.lat])+")"});vectorGroup.append("circle").attr("class",a.class).attr("cx",0).attr("cy",0).attr("r","2px").style("stroke","black").style("stroke-width",1).style("fill","red"),vectorGroup.append("text").attr("y",-5).style("text-anchor","middle").style("fill","#575757").style("opacity",0).style("font-family","'Open Sans', sans-serif").style("font-size",function(a){return d(a.idps).toFixed(2)+"em"}).style("font-weight","normal").text(function(a){return a.name}).transition().duration(2500).delay(1e3).style("opacity",1),vectorGroup.append("text").style("text-anchor","middle").style("fill","#0a4623").style("fill-opacity",0).style("font-family","'Open Sans', sans-serif").style("font-size",function(a){return e(a.idps).toFixed(2)+"em"}).style("font-weight","bold").text(function(a){return addCommas(a.idps)}).attr("y",function(){return d3.select(this).node().getBBox().height/2}).transition().duration(2500).delay(1e3).style("fill-opacity",.7);return void 0!=a.frame&&(vectorGroup=frameHandler(a.frame,vectorGroup)),vectorGroup},A.addEarthquake=function(a){var b=a.source.features,c=(a.size,9);b.sort(function(a,b){return+b.properties.mag-+a.properties.mag});var c=d3.max(b,function(a){return a.properties.mag}),d=d3.min(b,function(a){return a.properties.mag}),e=d3.scale.linear().domain([d,c]).range([0,30]),f=d3.scale.sqrt().domain([d,c]).range([.1,.5]),g=d3.scale.linear().domain([d,c]).range([.1,2]);d3.scale.sqrt().domain([d,c]).range([.6,.85]),d3.scale.linear().domain([d,c]).range([0,2.5]);return vectorGroup=G.selectAll("."+a.class).data(b).enter().append("g").attr("class","vector").attr("transform",function(a){return"translate("+C([a.geometry.coordinates[0],a.geometry.coordinates[1]])+")"}).on("mousemove",function(a,b){var c=d3.transform(d3.select(this).attr("transform")),d=c.translate[0],e=c.translate[1];coordinates=d3.mouse(this);var f=coordinates[0]+d,g=coordinates[1]+e;d3.select("#dM2").attr("transform","translate("+(f+13)+","+(g+5)+")")}).on("mouseout",function(a,b){d3.select("#dM2").attr("transform","translate(-100,-100)")}),vectorGroup.append("circle").attr("class",a.class).attr("cx",0).attr("cy",0).attr("r",function(a){return e(a.properties.mag)}).style("fill-opacity",function(a){return f(a.properties.mag)}).style("stroke-opacity",function(a){return f(a.properties.mag)}).attr("id",function(a){return"map"+a.id}).attr("class","mapbubble").style("stroke","#570809").style("stroke-width",function(a){return g(a.properties.mag)}).style("fill","darkred").on("mouseover",function(a,b){var c=new Date(a.properties.time),d=c.toTimeString().substring(0,5),c=c.getDate()+" "+monthNames[c.getMonth()]+" "+c.getFullYear()+" - "+d;d3.select(".mTitle").text("M"+a.properties.mag),d3.select(".mSubTitle1").text(c),d3.select("#dM2").style("opacity",1),d3.select(this).style("stroke-opacity",1);var e=a.id;d3.selectAll(".chartbubble").transition().duration(300).style("fill-opacity",function(a){return a.id==e?.4:.1}).style("stroke-opacity",function(a){return a.id==e?1:.1})}).on("mouseout",function(a,b){d3.select("#dM2").style("opacity",0);d3.selectAll(".chartbubble").transition().duration(300).style("fill-opacity",.4).style("stroke-opacity",function(a){return f(a.properties.mag)});d3.select(this).style("stroke-opacity",function(a){return f(a.properties.mag)})}),void 0!=a.frame&&(vectorGroup=frameHandler(a.frame,vectorGroup)),vectorGroup},A.addProportionalCircles=function(a){var b="idps",c=1,d=.2,e=0,f=0,g="#0a4a25",h=!0,i="name";a.source&&a.source,a.dataVariable&&(b=a.dataVariable),a.circleClass&&a.circleClass,a.opacity&&(c=a.opacity),a.circleOpacity&&(d=a.circleOpacity),a.color&&(g=a.color),a.fade&&(e=a.fade),a.delay&&(f=a.delay),void 0!=a.showTextLabel&&(h=a.showTextLabel),a.textVariable&&(i=a.textVariable);var j=a.source,k=d3.max(j,function(a){return+a[b]}),l=d3.scale.sqrt().domain([0,k]).range([0,40]),m=d3.scale.sqrt().domain([0,k]).range([.6,.75]),n=d3.scale.sqrt().domain([0,k]).range([.7,1.6]);(vectorGroup=G.selectAll("."+a.class).data(j).enter().append("g").classed({vector:!0}).style("opacity",c).attr("transform",function(a){return"translate("+C([a.lon,a.lat])+")"}),vectorGroup.append("circle").attr("class",a.class).attr("cx",0).attr("cy",0).attr("r",0).style("stroke",g).style("stroke-width",1).style("stroke-opacity",1).style("fill",g).style("fill-opacity",.5).style("opacity",0).transition().duration(e).delay(f/2).attr("r",function(a,c){return l(a[b])}).style("opacity",d),
1==h)&&(vectorGroup.append("text").attr("class","textName").attr("y",-5).style("text-anchor","middle").style("fill",g).style("opacity",0).style("font-family","'Open Sans', sans-serif").style("font-size",function(a){return m(a[b]).toFixed(2)+"em"}).style("font-weight","normal").text(function(a){return a[i]}).transition().duration(e).delay(f).style("opacity",1),vectorGroup.append("text").attr("class","textFigure").style("text-anchor","middle").style("fill",g).style("fill-opacity",0).style("font-family","'Open Sans', sans-serif").style("font-size",function(a){return n(a[b]).toFixed(2)+"em"}).style("font-weight","bold").text(function(a){return addCommas(a[b])}).attr("y",function(){return d3.select(this).node().getBBox().height/2}).transition().duration(e).delay(f).style("fill-opacity",.7));return vectorGroup.update=function(a){var b=a.dataVariable,c=a.duration,d=a.color;this.selectAll("circle").transition().duration(c).style("fill",d).style("stroke",d).attr("r",function(a,c){return l(a[b])}),this.selectAll(".textName").transition().duration(c).style("font-size",function(a){return m(a[b]).toFixed(2)+"em"}).text(function(a){return a[i]}),this.selectAll(".textFigure").transition().duration(c).style("fill",d).style("font-size",function(a){return n(a[b]).toFixed(2)+"em"}).attr("y",function(a){return 6*n(a[b])+3}).tween("text",function(a){var c=d3.interpolate(this.textContent.replace(/\,/g,""),a[b]),d=(a[b]+"").split("."),e=d.length>1?Math.pow(10,d[1].length):1;return function(a){this.textContent=addCommas(Math.round(c(a)*e)/e)}})},void 0!=a.frame&&(vectorGroup=frameHandler(a.frame,vectorGroup)),vectorGroup},A.addSymbolPoints=function(a){var b=12,c="normal",d="#000",e="'Open Sans', sans-serif",f="normal",g=1,h="symbol",i=12,j=12,k="./images/mapicons/Admin1Capital.svg",l=0,m=0,n=[{name:"Zero1",lat:2,lon:0}],o=0,p=0,q=0,r="right";if(void 0!=a.frame)var q=a.frame;a.source&&(n=a.source),a.fade&&(o=a.fade),a.delay&&(p=a.delay),a.class&&(h=a.class),a.orientation&&(r=a.orientation),a.hasOwnProperty("template")&&(a=symbolTemplate[a.template]),a.fontSize&&(b=a.fontSize),a.fontWeight&&(c=a.fontWeight),a.fontFamily&&(e=a.fontFamily),a.fontStyle&&(f=a.fontStyle),a.icon&&(k=a.icon),a.opacity&&(g=a.opacity),a.fontColor&&(d=a.fontColor),a.textAnchor&&(textAnchor=a.textAnchor),a.width&&(i=a.width),a.height&&(j=a.height),a.xOffset&&(l=a.xOffset),a.yOffset&&(m=a.yOffset);var s=G,t=s.selectAll(".symbolPoint ."+h).data(n).enter().append("g").style("opacity",1).attr("class","symbolPoint "+h).attr("transform",function(a){return"translate("+C([a.lon,a.lat])+")"}),u=t.append("text").text(function(a){return a.name}).style("font-family",e).style("font-style",f).style("fill",d).style("font-size",b).style("font-weight",c).attr("y",4);return"right"==r&&u.attr("x",8),"left"==r&&u.attr("x",function(){return-this.getBBox().width-7}),t.append("svg:image").attr("xlink:href",k).attr("width",i).attr("height",j).attr("x",-j/2-l).attr("y",-i/2-m).append("text").text(function(a){return a.name}),t.transition().delay(p).duration(o).style("opacity",g),0!=q&&(t=frameHandler(q,t)),t},A.addStyledLabels=function(a){var b="#000",c=1,d=25,e="./images/labels/label1.svg",f=[{name:"Zero1",lat:2,lon:0}],g=0,h=0;a.source&&(f=a.source),a.fade&&(g=a.fade),a.delay&&(h=a.delay),a.class&&(symbolClass=a.class),a.fontStyle&&(fontStyle=a.fontStyle),a.labelSource&&(e=a.labelSource),a.opacity&&(c=a.opacity),a.color&&(b=a.color),a.textAnchor&&(textAnchor=a.textAnchor),a.size&&(d=a.size),a.xOffset&&a.xOffset,a.yOffset&&a.yOffset;var i;d3.xml(e,"image/svg+xml",function(e){var j=document.importNode(e.documentElement,!0);i=A.selectAll(".styledLabel").data(f).enter().append("g").style("opacity",1).attr("class","styledLabel styledLabel1").attr("transform",function(a){return"translate("+C([a.lon,a.lat])+")"}).each(function(a,e){var f=a.name,i=this.appendChild(j.cloneNode(!0)),i=d3.select(i),k=i.attr("height",d).select("text"),l=(k.select("tspan").text(f),d3.select("body").append("svg")),m=l.append("text").text(f).style("font-size",function(){return k.style("font-size")}),n=l.node().getBBox();l.remove(),m.remove(),i.style("opacity",0).select("rect").attr("width",parseInt(n.width)+27).style("fill",b),i.select("path").style("fill",b),i.attr("width",parseInt(n.width)+66),i.attr("preserveAspectRatio","xMinYMin").attr("y",-d/2),i.transition().delay(h).duration(g).style("opacity",c)}),void 0!=a.frame&&(i=frameHandler(a.frame,i)),initFrame()})},A.addTextLabels=function(a){var b=12,c="normal",d="#000",e="'Open Sans', sans-serif",f="normal",g=1,h="middle",i="label",j=8,k=4,l=[{name:"Zero",lat:0,lon:0}],m=0,n=0;a.fontSize&&(b=a.fontSize),a.fontWeight&&(c=a.fontWeight),a.fontFamily&&(e=a.fontFamily),a.fontStyle&&(f=a.fontStyle),a.opacity&&(g=a.opacity),a.fontColor&&(d=a.fontColor),a.textAnchor&&(h=a.textAnchor),a.class&&(i=a.class),a.xOffset&&(j=a.xOffset),a.yOffset&&(k=a.yOffset),a.source&&(l=a.source),a.fade&&(m=a.fade),a.delay&&(n=a.delay);var o=G,p=o.selectAll(".labelPoint ."+i).data(l).enter().append("g").style("opacity",1).attr("class","textLabel "+i).attr("transform",function(a){return"translate("+C([a.lon,a.lat])+")"});return p.append("text").text(function(a){return a.name}).attr("x",j).attr("y",k).style("font-family",e).style("font-size",b).style("font-weight",c).style("font-style",f).style("fill",d).style("text-anchor",h).style("letter-spacing",.6),p.transition().delay(n).duration(m).style("opacity",g),void 0!=a.frame&&(p=frameHandler(a.frame,p)),p},A.zoomToBounds=function(a){dx=a[1][0]-a[0][0],dy=a[1][1]-a[0][1],x=(a[0][0]+a[1][0])/2,y=(a[0][1]+a[1][1])/2,scale=.9/Math.max(dx/v,dy/z),translate=[v/2-scale*x,z/2-scale*y],b()},A.addMask=function(a){var b=!1,c="mask";a.outline&&(b=a.outline),a.class&&(c=a.class),a.path&&(maskPath=a.path);var d=d3.svg.line().x(function(a){return e=C([a.lon,a.lat]),e[0]}).y(function(a){return e=C([a.lon,a.lat]),e[1]}).interpolate("cardinal-closed");$("body").append('<span id="svgFiltersTmp"></span>');$("#svgFiltersTmp").load("./images/filters.svg",null,function(){var e=$("#svgFiltersTmp svg defs");$(r).append(e);var f=H.append("g").attr("class",c).attr("fill-rule","evenodd").attr("x",0).attr("y",0).attr("transform",function(a){}),f=f.selectAll("#maskOutline").data([maskPath]).enter().append("path").attr("id","maskOutline").attr("d",function(a){return d(a)}).style("stroke","black").style("fill-opacity",0).style("fill","white");0==b&&f.style("fill-opacity",1).style("stroke","#FFF").style("filter","url(#blur111)");var g=f.attr("d");g="M-500,-500 L2000,0 L2000,2000 L0,2000 L-500,-500 Z "+g+" Z ",f.attr("d",g),void 0!=a.frame&&(f=frameHandler(a.frame,f))})},A.addLine=function(a){return G.append("path").datum({type:"LineString",coordinates:[a[0],a[1]]}).attr("class","route").attr("d",E).style("stroke","red").style("stroke-width",2)},A.addArrow=function(a){var b="#FFF",c=2,d=[{lat:44.42,lon:33.32},{lat:43,lon:29},{lat:43,lon:28}],f=1,g=0,h=0;a.color&&(b=a.color),a.strokeWidth&&(c=a.strokeWidth),a.source&&(d=a.source),a.opacity&&(f=a.opacity),a.fade&&(g=a.fade),a.delay&&(h=a.delay),arrow+=1,A.append("defs").append("marker").attr("id","arrowhead"+arrow).attr("refX",1).attr("refY",2).attr("markerWidth",3*c).attr("markerHeight",2*c).attr("orient","auto").append("path").attr("d","M 0,0 V 4 L6,2 Z").style("fill",b);var i=d3.svg.line().x(function(a){return e=C([a.lon,a.lat]),e[0]}).y(function(a){return e=C([a.lon,a.lat]),e[1]}).interpolate("basis"),j=G.selectAll(".path").data([d]);return j.enter().append("path"),j.attr("class","arrow").attr("d",function(a){return i(a)}).style("stroke",b).style("stroke-width",c).style("opacity",0).style("fill","none").attr("marker-end","url(#arrowhead"+arrow+")").style("stroke-linecap","round"),j.transition().delay(h).duration(g).style("opacity",f),void 0!=a.frame&&(j=frameHandler(a.frame,j)),j},A.svgImport=function(a){var b="./images/MyLayer.svg",c="MyLayer",d=1,e=0,f=0;a.source&&(b=a.source),a.layerId&&(c=a.layerId),a.opacity&&(d=a.opacity),a.fade&&(e=a.fade),a.delay&&(f=a.delay),d3.xml(b,function(b,g){var h=($(A[0]).parent("svg").attr("id"),g.getElementById(c));G.node().appendChild(h);var i=d3.select("#"+c).style("opacity",0).attr("class","import");if(d3.selectAll("#centerAnchor").node()){var j=d3.transform(K.attr("transform")).translate;d3.selectAll(".import").each(function(a){var b=d3.select(this).select("#anchor");if(b.node()){var c=b.node().getBBox(),d=j[0]-(c.x+c.width/2),e=j[1]-(c.y+c.height/2);d3.select(this).attr("transform","translate("+d+","+e+")")}})}d3.selectAll("#anchor").style("stroke-opacity",0),void 0!=a.frame&&(i=frameHandler(a.frame,i)),i.transition().delay(f).duration(e).style("opacity",d),initFrame()})},A.hexbin=function(a){var c="./images/MyLayer.svg",d="hex",e=.5,f="#bbbbbb",g=.5,h="red",i=15,j=["#F0B800","#DD0000"],k="auto";a.source&&(c=a.source),a.layerId&&(d=a.layerId),void 0!=a.opacity&&a.opacity,void 0!=a.hexStrokeOpacity&&(g=a.hexStrokeOpacity),void 0!=a.meshStrokeOpacity&&(e=a.meshStrokeOpacity),a.meshStrokeColor&&(f=a.meshStrokeColor),a.hexStrokeColor&&(h=a.hexStrokeColor),a.fade&&a.fade,a.radius&&(i=a.radius),a.delay&&a.delay,a.colorRange&&(j=a.colorRange),a.max&&(k=a.max);var l=d3.hexbin().size([v,z]).radius(i).x(function(a){return C([a.lon,a.lat])[0]}).y(function(a){return C([a.lon,a.lat])[1]}),m=G.append("g").attr("id",d+"_mesh").attr("d",E);m.append("clipPath").attr("id","clip").append("rect").attr("d",E).attr("class",d+"_mesh").attr("width",v).attr("height",z),m.append("svg:path").attr("clip-path","url(#clip)").attr("d",l.mesh()).style("stroke-width",.5).style("stroke",f).style("stroke-opacity",e).style("fill","none");var n=l(c),o=G.append("g").attr("d",E).attr("id",d),p=0;"auto"!=k?p=a.max:$(n).each(function(){this.length>p&&(p=this.length)}),d3.select("#maxIntensity").text(p);var q=d3.scale.sqrt().domain([1,p]).range([.2,1]),r=d3.scale.linear().domain([1,p]).range([j[0],j[1]]).interpolate(d3.interpolateLab),s=o.selectAll(".hexagon").data(n).enter().append("path").attr("class","hexagon").attr("d",function(a){return l.hexagon()}).attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).style("fill",function(a){return r(a.length)}).style("fill-opacity",function(a){return q(a.length)}).style("stroke-width",.5).style("stroke",h).style("stroke-opacity",g);void 0!=a.frame&&(o=frameHandler(a.frame,o),m=frameHandler(a.frame,m));var t=function(){m.remove(),d3.selectAll("#"+d).remove(),m=G.append("g").attr("id",d+"_mesh").attr("d",E),m.append("clipPath").attr("id","clip").append("rect").attr("d",E).attr("class",d+"_mesh").attr("width",v).attr("height",z),m.append("svg:path").attr("clip-path","url(#clip)").attr("d",l.mesh()).style("stroke-width",.5).style("stroke",f).style("stroke-opacity",e).style("fill","none"),n=l(c),o=G.append("g").attr("d",E).attr("id",d),n=l(c),p=0,"auto"!=k?p=a.max:$(n).each(function(){this.length>p&&(p=this.length)}),r=d3.scale.linear().domain([1,p]).range([j[0],j[1]]).interpolate(d3.interpolateLab),s=o.selectAll(".hexagon").data(n).enter().append("path").attr("class","hexagon").attr("d",function(a){return l.hexagon()}).attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).style("fill",function(a){return r(a.length)}).style("fill-opacity",function(a){return q(a.length)}).style("stroke-width",.5).style("stroke",h).style("stroke-opacity",g),void 0!=a.frame&&(o=frameHandler(a.frame,o),m=frameHandler(a.frame,m))};L.on("zoom",function(){b(),activeFrame==a.frame&&t()}),$("#"+T+" .zoomIn").on("click",function(){t()}),$("#"+T+" .zoomOut").on("click",function(){t()}),void 0!=a.frame&&(o=frameHandler(a.frame,o),m=frameHandler(a.frame,m))},A},this.svgImport=function(a){var b="./images/MyLayer.svg",c="MyLayer";if(a.source&&(b=a.source),a.layerId&&(c=a.layerId),a.opacity&&a.opacity,a.fade&&a.fade,a.delay&&a.delay,void 0==a.appendTo||""==a.appendTo)return alert("svgImport: no appendTo object has been set - e.g. 'appendTo': svg1"),!1;var d=a.appendTo,e=b.getElementById(c);d.node().appendChild(e),d3.selectAll("#"+c).attr("transform","translate(0,0)scale(0.83)")}},symbolTemplate={countrycapital:{fontSize:12,fontWeight:"bold",fontColor:"#000",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,symbolClass:"camps",width:11,height:11,icon:"./images/mapicons/CountryCapital.svg",xOffset:0,yOffset:0},admin1capital:{fontSize:12,fontWeight:"normal",fontColor:"#000",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,symbolClass:"camps",width:10,height:10,icon:"./images/mapicons/Admin1Capital.svg",xOffset:0,yOffset:0},admin2capital:{fontSize:11,fontWeight:"normal",fontColor:"#000",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,symbolClass:"camps",width:10,height:10,icon:"./images/mapicons/Admin2Capital.svg",xOffset:-1,yOffset:-.5},city:{fontSize:11,fontWeight:"normal",fontColor:"#333333",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,symbolClass:"camps",width:6,height:6,icon:"./images/mapicons/City.svg",xOffset:-2,yOffset:-.5},poi:{fontSize:11,fontWeight:"bold",fontColor:"#333333",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,symbolClass:"poi",width:6,height:6,icon:"./images/mapicons/POI.svg",xOffset:-2,yOffset:-.5},epicentre:{fontSize:12,fontWeight:"bold",fontColor:"#7D0302",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,symbolClass:"epicentre",width:14,height:14,icon:"./images/mapicons/epicentre.svg",xOffset:0,yOffset:0},office0:{fontSize:12,fontWeight:"bold",fontColor:"#000000",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,symbolClass:"office0",width:20,height:20,icon:"./images/mapicons/UNOffice.svg",xOffset:4,yOffset:0},office1:{fontSize:11,fontWeight:"bold",fontColor:"#000000",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,symbolClass:"office1",width:17,height:17,icon:"./images/mapicons/Office1.svg",xOffset:2,yOffset:0},office2:{fontSize:11,fontWeight:"bold",fontColor:"#000000",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,symbolClass:"office2",width:15,height:15,icon:"./images/mapicons/Office2.svg",xOffset:2,yOffset:0},office3:{fontSize:11,fontWeight:"bold",fontColor:"#000000",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,symbolClass:"office3",width:15,height:15,icon:"./images/mapicons/Office3.svg",xOffset:2,yOffset:0},office4:{fontSize:11,fontWeight:"bold",fontColor:"#000000",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,symbolClass:"office4",width:12,height:12,icon:"./images/mapicons/Office4.svg",xOffset:0,yOffset:0},office5:{fontSize:11,fontWeight:"bold",fontColor:"#000000",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,symbolClass:"office5",width:12,height:12,icon:"./images/mapicons/Office5.svg",xOffset:0,yOffset:0},camp:{fontSize:11,fontWeight:"bold",fontColor:"#000000",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,symbolClass:"camp",width:13,height:13,icon:"./images/mapicons/Camps.svg",xOffset:0,yOffset:0},location:{fontSize:10,fontWeight:"bold",fontColor:"#555555",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,symbolClass:"location",width:13,height:13,icon:"./images/mapicons/UrbanLocation.svg",xOffset:0,yOffset:-2},totalpop:{fontSize:10,fontWeight:"bold",fontColor:"#555555",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,symbolClass:"location",width:13,height:13,icon:"./images/mapicons/totalpop.svg",xOffset:0,yOffset:-2}},monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dataSources=[{name:"adm1",source:"scripts/geo/topojson/adm1.json"},{name:"adm3",source:"scripts/geo/topojson/adm3.json"},{name:"csv",source:"scripts/geo/data/deaths.csv"},{name:"world",source:"scripts/geo/topojson/nepalregion2.json"},{name:"districts",source:"scripts/geo/data/affected_districts.csv"},{name:"usgs",source:"scripts/geo/data/usgs.json"},{name:"topline",source:"scripts/geo/data/topline.csv"},{name:"layout",source:"images/layout.svg"}],ie=function(){for(var a=3,b=document.createElement("div"),c=b.getElementsByTagName("i");b.innerHTML="\x3c!--[if gt IE "+ ++a+"]><i></i><![endif]--\x3e",c[0];);return a>4?a:void 0}();if(ie<=9)throw document.getElementById("loaderContent0").style.display="block",new Error("Visualisation does not support IE7/8/9");document.getElementById("loaderContent1").style.display="block";var viz=new Vizlib(dataSources,function(a){function b(a){var b=$("#selectFrameDiv li:nth-child("+a+")").text();$("#selectFrame .textlabel").text(b)}var c=viz.createSvg({div:"#svgContainer",id:"mapsvg",frame:[1,2,3,4,5],aspectRatio:1.435,downloadButton:!1}),d=viz.map({appendTo:c,enableRaster:!0,center:[84.489614,28.153341],xOffset:-150,yOffset:-25,zoomInit:15,mapbox:"matthewsmawfield.31370f48",enableZoomButtons:!1,enableZoomMouseScroll:!1,enablePan:!1,zoomButtonsHtml:'<div class="zoomBox"><div class="zoom zoomIn"></div><div class="zoom zoomOut"></div></div>',zoomInSteps:1,zoomOutSteps:1,zoomFactor:1.5,coordinatesTooltip:!0,coordinatesToClipboard:!1,frame:[1,2,3,4,5]});$.each(a.csv,function(a,b){b.total=parseFloat(b.deaths.replace(/,/g,""))+parseFloat(b.injured.replace(/,/g,"")),b.bars=[parseFloat(b.deaths.replace(/,/g,"")),parseFloat(b.injured.replace(/,/g,""))]});viz.svgImport({appendTo:c,source:a.layout,id:"layout",layerId:"Layout"});$("tspan").each(function(){var a=$(this).attr("font-family");"OpenSans-Bold"==a&&$(this).attr("font-family","'Open Sans', sans-serif;").css("font-weight","bold"),"OpenSans-Italic"==a&&$(this).attr("font-family","'Open Sans', sans-serif;").css("font-style","italic"),"OpenSans"==a&&$(this).attr("font-family","'Open Sans', sans-serif;")});var e="http://data.unhcr.org/nepal";d3.select("#socialmedia").selectAll("#icon").style("cursor","pointer").on("mouseover",function(){d3.select(this).attr("opacity",.8)}).on("mouseout",function(){d3.select(this).attr("opacity",1)}),d3.select("#socialmedia #facebook").on("click",function(){window.open("https://www.facebook.com/dialog/feed?app_id=694165360698061&link=http%3A%2F%2Fdata.unhcr.org%2Fnepal&picture=http%3A%2F%2Fdata.unhcr.org%2Fnepal%2Fimages%2Fthumbnail.jpg&name=Nepal%20earthquakes%202015&caption=%20&description=Interactive%20data%20visualisation&redirect_uri=http%3A%2F%2Fwww.facebook.com%2F","_blank")}),d3.select("#socialmedia #twitter").on("click",function(){window.open("https://twitter.com/intent/tweet?url="+e+"&text=@Refugees%20%23dataviz%20%23nepalearthquake","_blank")}),d3.select("#socialmedia #pinterest").on("click",function(){window.open("http://pinterest.com/pin/create/button/?url="+e+"&media=http://data.unhcr.org/nepal/images/thumbnail.jpg","_blank")}),d3.select("#socialmedia #googleplus").on("click",function(){window.open("https://plus.google.com/share?&hl=en&url="+e,"_blank")}),d3.select("#socialmedia #embed").on("click",function(){console.log("click"),d3.select("#embedFrame").attr("transform","translate(0,800)")}),d3.select("#closeEmbed").style("cursor","pointer").on("click",function(){d3.select("#embedFrame").attr("transform","translate(0,-300)")}),d.addVectorPolygon({source:a.world,class:"world",fillOpacity:0,strokeOpacity:1,strokeWidth:2,strokeColor:"#FFF",frame:[1,2,3,4,5]}).style("fill",function(a){return a.properties.FIPS,"#CACACA"}).style("fill-opacity",function(a){return"NP"!=a.properties.FIPS?.5:0});var f=[{name:"name",lat:28.168359,lon:88.700279},{name:"name",lat:25.937761,lon:88.612389},{name:"name",lat:25.982211,lon:85.382408},{name:"name",lat:26.779421,lon:82.701744},{name:"name",lat:27.420019,lon:81.130699},{name:"name",lat:28.930735,lon:79.306969},{name:"name",lat:31.052433,lon:81.262535},{name:"name",lat:29.467787,lon:85.184654}],g=(d.addMask({class:"mapmask",outline:!1,path:f,frame:[1,2,3,4,5]}),[{name:"INDIA",lat:26.838254,lon:83.855309},{name:"CHINA",lat:29.341252,lon:85.041832}]),h=(d.addTextLabels({source:g,class:"countryNames",fontSize:"14px",fontWeight:"normal",fontFamily:"'Open Sans', sans-serif",fontColor:"#9e9e9e",fontStyle:"normal",textAnchor:"middle",xOffset:8,yOffset:4,opacity:1,fade:0,delay:0,frame:[1,2,3,4,5]}),d.addVectorPolygon({source:a.adm1,class:"adm1",fillOpacity:1,fill:"#FFF",strokeOpacity:1,strokeWidth:2,strokeColor:"#B6B6B6",frame:[1,2,3,4,5]}),[{name:"FAR-WESTERN",lat:29.376879,lon:80.898887},{name:"MID-WESTERN",lat:28.916311,lon:82.382042},{name:"WESTERN",lat:28.308702,lon:83.810264},{name:"CENTRAL",lat:27.619755,lon:85.392296},{name:"EASTERN",lat:27.151512,lon:87.248985}]),i=(d.addTextLabels({source:h,class:"regionNames",fontSize:"13px",fontWeight:"normal",fontFamily:"'Open Sans', sans-serif",fontColor:"#9e9e9e",fontStyle:"normal",textAnchor:"middle",xOffset:8,yOffset:4,opacity:1,fade:0,delay:0,frame:[2,3,4,5]}),d.addVectorPolygon({source:a.adm3,class:"adm3",fill:"transparent",strokeOpacity:1,strokeWidth:.5,strokeColor:"#BFBFBF",frame:[1,2,3,4,5]}),d.addVectorPolygon({source:a.adm3,class:"killed",fillOpacity:.7,fill:"#FFF",strokeOpacity:.15,strokeWidth:.5,strokeColor:"#000",frame:[4]})),j=d.addVectorPolygon({source:a.adm3,class:"injured",fillOpacity:.7,fill:"#FFF",strokeOpacity:.15,strokeWidth:.5,strokeColor:"#000",frame:[5]}),k=d3.sum(a.csv,function(a){return parseFloat(a.deaths.replace(/,/g,""))}),l=d3.sum(a.csv,function(a){return parseFloat(a.injured.replace(/,/g,""))}),m=d3.max(a.csv,function(a){return a.date});$("#toplinetotal1 tspan").text(addCommas(k)),$("#toplinetotal2 tspan").text(addCommas(l)),$("#deathDate tspan").text("As of "+getToplineDate(m));var n=d3.scale.threshold().domain([1,50,100,250,500,1e3,2e3,1e5]).range(["0","1 - 49","50 - 99","100 - 249","250 - 499","500 - 999","1,000 - 1,999","2,000+"]),o=d3.scale.threshold().domain([1,50,100,250,500,1e3,2e3,1e5]).range(["#FFF","#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"]),p=d3.scale.threshold().domain([1,50,100,250,500,1e3,2e3,1e5]).range(["#FFF","#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801"]),q=c.append("g").attr("class","legendKilled frame frame4").attr("transform","translate(20,390)");q.append("text").attr("x",0).attr("y",-10).style("font-family","'Open Sans', sans-serif").style("font-weight","bold").style("font-size","12px").text("People killed");var r=15,s=25,t=q.selectAll(".legendKilledRow").data(o.range()).enter().append("g").attr("transform",function(a,b){return"translate(0,"+(r+3)*b+")"});t.append("rect").style("stroke","grey").style("stroke-width",.5).attr("width",s).attr("height",r).attr("x",0).attr("y",0).style("fill",function(a,b){return o.range()[b]}),t.append("text").attr("x",30).attr("y",12).style("font-size","11px").style("fill","#000").text(function(a,b){return n.range()[b]}),i.style("fill",function(b){var c=0;return $(a.csv).each(function(){this.OCHA_PCODE==b.properties.pcode&&(c=this.deaths)}),o(c)}),i.on("mouseover",function(b){var c,d=(d3.select(this).style("fill-opacity",.8).style("stroke-opacity",.5),"No Data"),e=0,f=0;$(a.csv).each(function(){this.OCHA_PCODE==b.properties.pcode&&(d=this.severity_class,c=b.properties.name,e=this.deaths>0?this.deaths:0,f=this.injured>0?this.injured:0)}),d3.select("#dM").style("opacity",1),d3.selectAll(".mTitle").text(c),d3.selectAll(".mSubTitle1").text("DEATHS"),d3.selectAll(".mSubTitle2").text("INJURED"),d3.selectAll(".mFigure1").text(addCommas(e)),d3.selectAll(".mFigure2").text(addCommas(f)),d3.selectAll(".mBox1").style("fill",o(e)),d3.selectAll(".mBox2").style("fill",p(f))}).on("mouseout",function(){d3.select(this).style("fill-opacity",.7).style("stroke-opacity",.15),d3.select("#dM").style("opacity",0).attr("transform","translate(-100,-100)")}).on("mousemove",function(){coordinates=d3.mouse(this);var a=coordinates[0],b=coordinates[1];d3.select("#dM").attr("transform","translate("+(a+10)+","+(b+5)+")")});var u=c.append("g").attr("class","legendInjured frame frame5").attr("transform","translate(20,390)");u.append("text").attr("x",0).attr("y",-10).style("font-family","'Open Sans', sans-serif").style("font-weight","bold").style("font-size","12px").text("People injured");var r=15,s=25,v=u.selectAll(".legendInjuredRow").data(p.range()).enter().append("g").attr("transform",function(a,b){return"translate(0,"+(r+3)*b+")"});v.append("rect").style("stroke","grey").style("stroke-width",.5).attr("width",s).attr("height",r).attr("x",0).attr("y",0).style("fill",function(a,b){return p.range()[b]}),v.append("text").attr("x",30).attr("y",12).style("font-size","11px").style("fill","#000").text(function(a,b){return n.range()[b]}),j.style("fill",function(b){var c=0;return $(a.csv).each(function(){this.OCHA_PCODE==b.properties.pcode&&(c=this.injured)}),p(c)}),j.on("mouseover",function(b){var c,d=(d3.select(this).style("fill-opacity",.8).style("stroke-opacity",.5),"No Data"),e=0,f=0;$(a.csv).each(function(){this.OCHA_PCODE==b.properties.pcode&&(d=this.severity_class,c=b.properties.name,e=this.deaths>0?this.deaths:0,f=this.injured>0?this.injured:0)}),d3.select("#dM").style("opacity",1),d3.selectAll(".mTitle").text(c),d3.selectAll(".mSubTitle1").text("DEATHS"),d3.selectAll(".mSubTitle2").text("INJURED"),d3.selectAll(".mFigure1").text(addCommas(e)),d3.selectAll(".mFigure2").text(addCommas(f)),d3.selectAll(".mBox1").style("fill",o(e)),d3.selectAll(".mBox2").style("fill",p(f))}).on("mouseout",function(){d3.select(this).style("fill-opacity",.7).style("stroke-opacity",.15),d3.select("#dM").style("opacity",0).attr("transform","translate(-100,-100)")}).on("mousemove",function(){coordinates=d3.mouse(this);var a=coordinates[0],b=coordinates[1];d3.select("#dM").attr("transform","translate("+(a+10)+","+(b+5)+")")}),$("#mapAnnotation").attr("class","frame frame1");var w=(viz.tableBar({source:a.csv,appendTo:c,id:"topKilled",class:"topKilled",width:210,height:400,xOffset:950,yOffset:170,limit:15,title:"Top 10 Districts",valueField:"deaths",nameField:"DISTRICT",fillOpacity:.8,fill:"#cb181d",frame:[1,2,3,4,5]}),d.addEarthquake({source:a.usgs,class:"earthquake",opacity:1,frame:[1],fade:2e3,delay:0}),viz.bubbleChart({appendTo:c,source:a.usgs,xOffset:40,yOffset:600,width:1030,height:180,fill:"#69D2E7",strokeColor:"#F38630",strokeWidth:7,opacity:1,frame:1}),[{name:"Kathmandu",lat:27.70169,lon:85.3206}]),x=(d.addSymbolPoints({source:w,icon:"./images/mapicons/CountryCapital.svg",class:"capital",width:12,height:12,xOffset:0,yOffset:0,fontSize:12,fontWeight:"bold",fontColor:"#000",fontFamily:"'Open Sans', sans-serif",fontStyle:"normal",opacity:1,frame:[1],fade:2e3,delay:0,orientation:"left"}),[{name:"Pokhara",lat:28.26689,lon:83.96851}]),y=(d.addSymbolPoints({source:x,template:"admin1capital",class:"admin1capital",frame:[1],opacity:1,fade:0,delay:0,orientation:"left"}),[{name:"Mount Everest",lat:27.9881,lon:86.9253}]),z=(d.addSymbolPoints({source:y,template:"location",class:"location",frame:[1],opacity:1,fade:0,delay:0,orientation:"right"}),c.append("g").attr("id","dM2").attr("transform","translate(-100,-100)").style("opacity",0));z.append("rect").attr("width",110).attr("height",35).style("fill","#FFF").style("fill-opacity",.8),z.append("text").attr("x",5).attr("y",15).attr("class","mTitle").text("M7.7"),z.append("text").attr("x",5).attr("y",29).attr("class","mSubTitle1").text("26 April - 03:20");var A=c.append("g").attr("id","dM").attr("transform","translate(-100,-100)").style("opacity",0);A.append("rect").attr("width",110).attr("height",90).style("fill","#FFF").style("fill-opacity",.8),A.append("text").attr("x",5).attr("y",15).attr("class","mTitle").text("District"),A.append("text").attr("x",5).attr("y",31).attr("class","mSubTitle1").text("POPULATION"),A.append("rect").attr("class","mBox1").attr("x",5).attr("y",37).attr("height",10).attr("width",3).style("fill","blue"),A.append("text").attr("x",12).attr("y",46).attr("class","mFigure1").text("n/a"),A.append("text").attr("x",5).attr("y",65).attr("class","mSubTitle2").text("HOUSEHOLDS"),A.append("rect").attr("class","mBox2").attr("x",5).attr("y",72).attr("height",10).attr("width",3).style("fill","blue"),A.append("text").attr("x",12).attr("y",81).attr("class","mFigure2").text("n/a"),$("#framePrev, #leftButton").click(function(){var a=viz.prevFrame(1e3);$("#lContent").scrollTop(0),b(a),$("#activeFrame").text(a)}),$("#frameNext, #rightButton").click(function(){var a=viz.nextFrame(1e3);$("#lContent").scrollTop(0),b(a),$("#activeFrame").text(a)}),$(".selectFrame").on("click",function(){var a=$(this).attr("id"),b=$(this).text();viz.gotoFrame(a,1e3),$("#selectFrame .textlabel").text(b),$("#activeFrame").text(a)}),$("#button3Line, #button4Line").hide(),$("#button1").click(function(){viz.gotoFrame(1,700),$("#lContent").scrollTop(0),b(1),$("#activeFrame").text(1),$("#button3Line, #button4Line").hide(),$("#button1Line").show()}),$(".button3").click(function(){viz.gotoFrame(3,700),$("#lContent").scrollTop(0),b(1),$("#activeFrame").text(1),$(".fill1, .fill2, .fill4, .fill5").css("opacity",.5),$(".fill3").css("opacity",1)}),$("#button3").click(function(){viz.gotoFrame(4,700),$("#lContent").scrollTop(0),b(1),$("#activeFrame").text(1),$("#button1Line, #button4Line").hide(),$("#button3Line").show()}),$("#button4").click(function(){viz.gotoFrame(5,700),$("#lContent").scrollTop(0),b(1),$("#activeFrame").text(1),$("#button1Line, #button3Line").hide(),$("#button4Line").show()}),viz.maxFrames(5),viz.gotoFrame(1),$(document).ready(function(){$("#loader").hide()})});